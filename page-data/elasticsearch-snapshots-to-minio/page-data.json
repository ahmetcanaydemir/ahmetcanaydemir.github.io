{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/elasticsearch-snapshots-to-minio/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Ahmet Can Aydemir","author":"Ahmet Can Aydemir"}},"markdownRemark":{"id":"f2985754-e340-5e98-a582-6053f5f34178","html":"<p><a href=\"/x/\"></a></p>\n<p>Minio is a high performance, self-hosted AWS S3 compatible object storage solution.</p>\n<p>I will explain how we can store Elasticsearch snapshots in Minio.</p>\n<h2 id=\"prerequisites\" style=\"position:relative;\"><a href=\"#prerequisites\" aria-label=\"prerequisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prerequisites</h2>\n<ul>\n<li>Minio</li>\n<li>Elasticsearch</li>\n</ul>\n<hr>\n<h2 id=\"creating-bucket\" style=\"position:relative;\"><a href=\"#creating-bucket\" aria-label=\"creating bucket permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating Bucket</h2>\n<p>First we need a bucket to store elasticsearch snapshots.</p>\n<p>You can create a bucket at Minio UI Console. Click <strong>Buckets</strong> from the left menu and click <strong>Create Bucket</strong>.</p>\n<hr>\n<h2 id=\"creating-a-service-account\" style=\"position:relative;\"><a href=\"#creating-a-service-account\" aria-label=\"creating a service account permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating a Service Account</h2>\n<p>A service account is also required to establish a minio connection with Elasticsearch.</p>\n<p>You can create a service account at Minio UI Console. Click <strong>Service Accounts</strong> from the left menu and click <strong>Create Service Account</strong>.</p>\n<p>Save the <strong>Secret Key</strong> and <strong>Access Key</strong>, we will use this information during the plugin installation.</p>\n<hr>\n<h2 id=\"elasticsearch-s3-repository-plugin-installation\" style=\"position:relative;\"><a href=\"#elasticsearch-s3-repository-plugin-installation\" aria-label=\"elasticsearch s3 repository plugin installation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Elasticsearch S3 Repository Plugin Installation</h2>\n<p>Since Minio is compatible with Amazon AWS S3, we will use the S3 repository plugin. To install the plugin, connect to all elasticsearch nodes and follow the steps below.</p>\n<p>First of all, install <code class=\"language-text\">repository-s3</code> plugin with following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/usr/share/elasticsearch/bin/elasticsearch-plugin <span class=\"token function\">install</span> repository-s3</code></pre></div>\n<p>An S3 client named <code class=\"language-text\">default</code> will be created after plugin installed. Actions to be taken can be performed by this client. We will define the <code class=\"language-text\">access_key</code> and <code class=\"language-text\">secret_key</code> information to the default client for accessing minio.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/usr/share/elasticsearch/bin/elasticsearch-keystore <span class=\"token function\">add</span> s3.client.default.secret_key\n<span class=\"token comment\"># Waiting for secret key</span>\n\n/usr/share/elasticsearch/bin/elasticsearch-keystore <span class=\"token function\">add</span> s3.client.default.access_key\n<span class=\"token comment\"># Waiting for access key</span></code></pre></div>\n<p>After this stage, elasticsearch service should be restarted.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">systemctl restart elasticsearch</code></pre></div>\n<hr>\n<h2 id=\"adding-elasticsearch-repository\" style=\"position:relative;\"><a href=\"#adding-elasticsearch-repository\" aria-label=\"adding elasticsearch repository permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Adding Elasticsearch Repository</h2>\n<p>A repository named <code class=\"language-text\">my-minio-repository</code> can be created by sending following request:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">PUT _snapshot/my-minio-repository <span class=\"token punctuation\">{</span>\n   <span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"s3\"</span>,\n   <span class=\"token string\">\"settings\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"client\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"default\"</span>,\n      <span class=\"token string\">\"bucket\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"elasticsearch-snapshots\"</span>,\n      <span class=\"token string\">\"endpoint\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"minio.example.com\"</span>,\n      <span class=\"token string\">\"path_style_access\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"true\"</span>,\n      <span class=\"token string\">\"protocol\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"http\"</span>\n   <span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2 id=\"manual-snapshot\" style=\"position:relative;\"><a href=\"#manual-snapshot\" aria-label=\"manual snapshot permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Manual snapshot</h2>\n<p>A snapshot named <code class=\"language-text\">my-first-snapshot</code> can be taken manually by sending following request:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">PUT /_snapshot/my-minio-repository/my-first-snapshot?wait_for_completion<span class=\"token operator\">=</span>true</code></pre></div>\n<hr>\n<h2 id=\"taking-snapshots-with-policy\" style=\"position:relative;\"><a href=\"#taking-snapshots-with-policy\" aria-label=\"taking snapshots with policy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Taking snapshots with policy</h2>\n<p>If desired, the snapshot process can be automated using the <code class=\"language-text\">snapshot policy</code>. For example, the policy below will save snapshots of all indexes to the minio repository at 07:30 every day.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">PUT _slm/policy/daily-snapshots\n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"name\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"&lt;daily-snapshot-{now/d}>\"</span>,\n    <span class=\"token string\">\"schedule\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"0 30 7 * * ?\"</span>,\n    <span class=\"token string\">\"repository\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"my-minio-repository\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2 id=\"restoring-snapshots\" style=\"position:relative;\"><a href=\"#restoring-snapshots\" aria-label=\"restoring snapshots permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Restoring snapshots</h2>\n<p>The <code class=\"language-text\">my-first-snapshot</code> backup can be restored with the following request:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">POST /_snapshot/my-minio-repository/my-first-snapshot/_restore</code></pre></div>\n<h2 id=\"resource\" style=\"position:relative;\"><a href=\"#resource\" aria-label=\"resource permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Resource</h2>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshot-restore.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshot-restore.html</a></p>","timeToRead":2,"frontmatter":{"title":"Elasticsearch Snapshots to Minio","date":"December 23, 2021","spoiler":"Store your elasticsearch backups in Minio repository."},"fields":{"slug":"/elasticsearch-snapshots-to-minio/","langKey":"en"}}},"pageContext":{"slug":"/elasticsearch-snapshots-to-minio/","previous":{"fields":{"slug":"/gitlab-ci-update-mr-with-jira-issue-id/","langKey":"en","directoryName":"gitlab-ci-update-mr-with-jira-issue-id","maybeAbsoluteLinks":["/x/","/git-hooks-enforce-commit-message-and-branch-name/"]},"frontmatter":{"title":"GitLab CI: Update MR with Jira Issue Id"}},"next":null,"translations":["tr"],"translatedLinks":[]}},
    "staticQueryHashes": ["336482444"]}